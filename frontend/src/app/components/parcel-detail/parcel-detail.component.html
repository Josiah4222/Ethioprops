<div class="parcel-detail-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading property details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <i class="fas fa-exclamation-circle"></i>
    <p>{{ error }}</p>
    <button class="btn btn-primary" routerLink="/parcels">Back to Search</button>
  </div>

  <!-- Parcel Details -->
  <div *ngIf="parcel && !loading" class="parcel-detail">
    <!-- Header -->
    <div class="detail-header">
      <button class="btn-back" routerLink="/parcels">
        <i class="fas fa-arrow-left"></i> Back to Search
      </button>
      <div class="header-actions">
        <button class="btn btn-outline" (click)="toggleShare()">
          <i class="fas fa-share-alt"></i> Share
        </button>
        <button class="btn btn-outline" (click)="printPage()">
          <i class="fas fa-print"></i> Print
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="detail-content">
      <div class="detail-main">
        <h1>{{ parcel.title || parcel.parcel_id }}</h1>
        <div class="property-meta">
          <span class="property-type">{{ parcel.property_type }}</span>
          <span class="status-badge" [class]="parcel.status?.toLowerCase()">{{ parcel.status }}</span>
          <span class="location"><i class="fas fa-map-marker-alt"></i> {{ parcel.sub_city }}, {{ parcel.landmark }}</span>
        </div>

        <!-- Price -->
        <div class="price-section" *ngIf="parcel.sale_price || parcel.lease_price_monthly">
          <div class="price-main" *ngIf="parcel.sale_price">
            <label>Sale Price</label>
            <h2>{{ formatPrice(parcel.sale_price) }}</h2>
          </div>
          <div class="price-secondary" *ngIf="parcel.lease_price_monthly">
            <label>Monthly Lease</label>
            <p>{{ formatPrice(parcel.lease_price_monthly) }}</p>
          </div>
          <div class="price-per-sqm" *ngIf="parcel.price_per_sqm">
            <label>Price per m²</label>
            <p>{{ formatPrice(parcel.price_per_sqm) }}</p>
          </div>
        </div>

        <!-- Description -->
        <div class="description-section" *ngIf="parcel.description">
          <h3>Description</h3>
          <p>{{ parcel.description }}</p>
        </div>

        <!-- Property Details -->
        <div class="details-grid">
          <div class="detail-card">
            <h3>Property Information</h3>
            <div class="detail-row">
              <label>Parcel ID</label>
              <span>{{ parcel.parcel_id }}</span>
            </div>
            <div class="detail-row">
              <label>Area</label>
              <span>{{ formatArea(parcel.area_sqm) }}</span>
            </div>
            <div class="detail-row">
              <label>Dimensions</label>
              <span>{{ parcel.dimensions || 'N/A' }}</span>
            </div>
            <div class="detail-row">
              <label>Zoning</label>
              <span>{{ parcel.zoning_info }}</span>
            </div>
          </div>

          <div class="detail-card">
            <h3>Location</h3>
            <div class="detail-row">
              <label>Sub-City</label>
              <span>{{ parcel.sub_city }}</span>
            </div>
            <div class="detail-row">
              <label>Wereda</label>
              <span>{{ parcel.wereda }}</span>
            </div>
            <div class="detail-row">
              <label>Street</label>
              <span>{{ parcel.street_name || 'N/A' }}</span>
            </div>
            <div class="detail-row">
              <label>Landmark</label>
              <span>{{ parcel.landmark || 'N/A' }}</span>
            </div>
          </div>

          <div class="detail-card">
            <h3>Infrastructure</h3>
            <div class="detail-row">
              <label>Electricity</label>
              <span>{{ parcel.has_electricity ? '✓ Yes' : '✗ No' }}</span>
            </div>
            <div class="detail-row">
              <label>Water</label>
              <span>{{ parcel.has_water ? '✓ Yes' : '✗ No' }}</span>
            </div>
            <div class="detail-row">
              <label>Sewage</label>
              <span>{{ parcel.has_sewage ? '✓ Yes' : '✗ No' }}</span>
            </div>
            <div class="detail-row">
              <label>Road Access</label>
              <span>{{ parcel.road_access }}</span>
            </div>
          </div>
        </div>

        <!-- Nearby Amenities -->
        <div class="amenities-section" *ngIf="parcel.amenities && parcel.amenities.length > 0">
          <h3>Nearby Amenities</h3>
          <div class="amenities-grid">
            <div class="amenity-card" *ngFor="let amenity of parcel.amenities">
              <span class="amenity-icon">{{ getAmenityIcon(amenity.amenity_type) }}</span>
              <div class="amenity-info">
                <strong>{{ amenity.name }}</strong>
                <span class="distance">{{ amenity.distance_km }} km away</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Contact Section -->
        <div class="contact-section">
          <h3>Interested in this property?</h3>
          <button class="btn btn-primary btn-large" (click)="toggleInquiryForm()">
            <i class="fas fa-envelope"></i> Send Inquiry
          </button>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="detail-sidebar">
        <div class="sidebar-card">
          <h3>Owner Information</h3>
          <div class="owner-info">
            <p><strong>{{ parcel.owner_name || 'N/A' }}</strong></p>
            <p *ngIf="parcel.owner_phone">
              <i class="fas fa-phone"></i>
              <a href="tel:{{ parcel.owner_phone }}">{{ parcel.owner_phone }}</a>
            </p>
            <p *ngIf="parcel.owner_email">
              <i class="fas fa-envelope"></i>
              <a href="mailto:{{ parcel.owner_email }}">{{ parcel.owner_email }}</a>
            </p>
          </div>
        </div>

        <div class="sidebar-card">
          <h3>Property Stats</h3>
          <div class="stats">
            <div class="stat-item">
              <i class="fas fa-eye"></i>
              <span>{{ parcel.views_count || 0 }} views</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-calendar"></i>
              <span>Listed {{ parcel.created_at | date:'mediumDate' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Inquiry Form Modal -->
  <div class="modal" *ngIf="showInquiryForm" (click)="toggleInquiryForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Send Inquiry</h2>
        <button class="btn-close" (click)="toggleInquiryForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body" *ngIf="!inquirySuccess">
        <form (ngSubmit)="submitInquiry()">
          <div class="form-group">
            <label>Your Name *</label>
            <input type="text" [(ngModel)]="inquiry.name" name="name" required>
          </div>
          
          <div class="form-group">
            <label>Email *</label>
            <input type="email" [(ngModel)]="inquiry.email" name="email" required>
          </div>
          
          <div class="form-group">
            <label>Phone *</label>
            <input type="tel" [(ngModel)]="inquiry.phone" name="phone" required>
          </div>
          
          <div class="form-group">
            <label>Inquiry Type</label>
            <select [(ngModel)]="inquiry.inquiry_type" name="inquiry_type">
              <option value="INFO">General Information</option>
              <option value="VIEWING">Schedule Viewing</option>
              <option value="OFFER">Make an Offer</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Message *</label>
            <textarea [(ngModel)]="inquiry.message" name="message" rows="4" required></textarea>
          </div>
          
          <button type="submit" class="btn btn-primary" [disabled]="inquirySubmitting">
            {{ inquirySubmitting ? 'Sending...' : 'Send Inquiry' }}
          </button>
        </form>
      </div>
      
      <div class="modal-body success-message" *ngIf="inquirySuccess">
        <i class="fas fa-check-circle"></i>
        <h3>Inquiry Sent Successfully!</h3>
        <p>The property owner will contact you soon.</p>
      </div>
    </div>
  </div>
</div>
